import{L as l}from"./leaflet-src.1665546880675.js";import{a as u}from"./index.1665546880675.js";import{l as _,a as m,o as d}from"./vue.1665546880675.js";(function(e,t){typeof define=="function"&&define.amd?define(["leaflet"],e):typeof exports=="object"&&(module.exports=e(require("leaflet"))),typeof t!="undefined"&&t.L&&e(L)})(function(e){e.Measure={linearMeasurement:"Distance measurement",areaMeasurement:"Area measurement",start:"Start",meter:"m",kilometer:"km",squareMeter:"m\xB2",squareKilometers:"km\xB2"},e.Control.Measure=e.Control.extend({options:{position:"topright",title:"Measurement",collapsed:!0,color:"#FF0080"},initialize:function(t){e.Util.setOptions(this,t)},onAdd:function(t){return this._map=t,this._container||this._initLayout(),this._container},_buildContainer:function(){if(this._container=e.DomUtil.create("div","leaflet-control-measure leaflet-bar leaflet-control"),this._contents=e.DomUtil.create("div","leaflet-measure-contents",this._container),this._link=e.DomUtil.create("a","leaflet-measure-toggle",this._container),this._link.title=this.options.title||"Measurement",this._link.href="#",this.options.title){var t=e.DomUtil.create("h3","",this._contents);t.innerText=this.options.title}this._buildItems()},_buildItems:function(){var t=e.DomUtil.create("ul","leaflet-measure-actions",this._contents),i=e.DomUtil.create("li","leaflet-measure-action",t),a=e.DomUtil.create("a","start length",i);a.innerText=e.Measure.linearMeasurement,a.href="javascript:void(0)",e.DomEvent.disableClickPropagation(a),e.DomEvent.on(a,"click",this._enableMeasureLine,this),i=e.DomUtil.create("li","leaflet-measure-action",t);var s=e.DomUtil.create("a","leaflet-measure-action start area",i);s.innerText=e.Measure.areaMeasurement,s.href="javascript:void(0)",e.DomEvent.disableClickPropagation(s),e.DomEvent.on(s,"click",this._enableMeasureArea,this)},_initLayout:function(){this._buildContainer(),e.DomEvent.disableClickPropagation(this._container),e.DomEvent.disableScrollPropagation(this._container),this.options.collapsed?e.DomEvent.on(this._container,{mouseenter:this._expand,mouseleave:this._collapse},this):this._expand()},_enableMeasureLine:function(t){e.DomEvent.stopPropagation(t),this._measureHandler=new e.MeasureAction(this._map,{model:"distance",color:this.options.color}),this._measureHandler.enable()},_enableMeasureArea:function(t){e.DomEvent.stopPropagation(t),this._measureHandler=new e.MeasureAction(this._map,{model:"area",color:this.options.color}),this._measureHandler.enable()},_expand:function(){return this._link.style.display="none",e.DomUtil.addClass(this._container,"leaflet-measure-expanded"),this},_collapse:function(){return this._link.style.display="block",e.DomUtil.removeClass(this._container,"leaflet-measure-expanded"),this}}),e.control.measure=e.control.Measure=function(t){return new e.Control.Measure(t)},e.MeasureLable=e.Layer.extend({options:{offset:new e.Point(0,30),latlng:null,content:"",className:""},initialize:function(t){e.Util.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||this._initLayout(),t._panes.popupPane.appendChild(this._container),t.on("viewreset",this._updatePosition,this),e.Browser.any3d&&t.on("zoomanim",this._zoomAnimation,this),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),t.off({viewreset:this._updatePosition,zoomanim:this._zoomAnimation},this),this._map=null},setLatLng:function(t){return this.options.latlng=e.latLng(t),this._updatePosition(),this},setContent:function(t){return this.options.content=t,this._updateContent(),this},_initLayout:function(){this._container=e.DomUtil.create("div",this.options.className),this._contentNode=e.DomUtil.create("div","content",this._container)},_update:function(){this._map&&(this._updateContent(),this._updatePosition())},_updateContent:function(){this.options.content&&(typeof this.options.content=="string"?this._contentNode.innerHTML=this.options.content:(this._contentNode.innerHTML="",this._contentNode.appendChild(this.options.content)))},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this.options.latlng),i=e.Browser.any3d,a=this.options.offset;i&&e.DomUtil.setPosition(this._container,t),this._containerBottom=-a.y-(i?0:t.y),this._containerLeft=a.x+(i?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(t){t=this._map._latLngToNewLayerPoint(this.options.latlng,t.zoom,t.center),e.DomUtil.setPosition(this._container,t)},enableClose:function(){return this._closeButton=e.DomUtil.create("span","close",this._container),this._closeButton.innerHTML='<svg class="icon" viewBox="0 0 40 40"><path style="stroke:#FF0000;stroke-width:3" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg>',this._closeButton}}),e.MeasureAction=e.Handler.extend({options:{color:"#FF0080",model:"distance"},initialize:function(t,i){this._map=t,this._map._measureHandler=this,e.Util.setOptions(this,i)},setModel:function(t){return this.options.model=t,this},addHooks:function(){this._activeMeasure()},removeHooks:function(){},_activeMeasure:function(){this._map._measureHandler._measurementStarted&&this._map._measureHandler._finishMeasure(),this._measurementStarted?this._finishMeasure():this._enableMeasure()},_onMouseClick:function(t){var i=t.latlng||this._map.mouseEventToLatLng(t);if(!(this._lastPoint&&i.equals(this._lastPoint))){if(this._trail.points.length>0){var a=this._trail.points;a.push(i);var s=a.length;this._totalDistance+=this._getDistance(a[s-2],a[s-1]),this._addMeasurePoint(i),this._addMarker(i),this.options.model!=="area"&&this._addLable(i,this._getDistanceString(this._totalDistance),"leaflet-measure-lable")}else this._totalDistance=0,this._addMeasurePoint(i),this._addMarker(i),this.options.model!=="area"&&this._addLable(i,e.Measure.start,"leaflet-measure-lable"),this._trail.points.push(i);this._lastPoint=i,this._startMove=!1}},_onMouseMove:function(t){var i=t.latlng;this._trail.points.length>0&&(this._startMove?this._directPath.setLatLngs(this._trail.points.concat(i)):(this._directPath.setLatLngs([i]),this._startMove=!0))},_enableMeasure:function(){this._trail={overlays:[],points:[]};var t=this._map;e.DomUtil.addClass(t._container,"leaflet-measure-map"),t.contextMenu&&t.contextMenu.disable(),this._measurementStarted=!0,t.on("click",this._onMouseClick,this),t.on("dblclick contextmenu",this._finishMeasure,this),t.doubleClickZoom.disable(),t.on("mousemove",this._onMouseMove,this)},_disableMeasure:function(){var t=this._map;e.DomUtil.removeClass(t.getContainer(),"leaflet-measure-map"),t.contextMenu&&t.contextMenu.enable(),t.off("click",this._onMouseClick,this),t.off("dblclick contextmenu",this._finishMeasure,this),t.off("mousemove",this._onMouseMove,this),t.doubleClickZoom.enable(),this._measurementStarted=this._startMove=!1,this.disable()},_finishMeasure:function(t){this._trail.points.length>0&&(this._trail.points.length>1?((!t||t.type==="contextmenu")&&this._directPath.setLatLngs(this._trail.points),this.options.model==="area"?this._addLable(this._lastPoint,this._getAreaString(this._trail.points),"leaflet-measure-lable",!0):this._addLable(this._lastPoint,this._getDistanceString(this._totalDistance),"leaflet-measure-lable",!0),this._directPath&&this._map.removeLayer(this._directPath)):this._clearOverlay.call(this)),this._disableMeasure()},_resetDirectPath:function(t){this._directPath?this._directPath.addLatLng(t):(this.options.model==="area"?this._directPath=new e.Polygon([t],{weight:2,color:this.options.color,dashArray:[5,5],fillOpacity:0,interactive:!1}):this._directPath=new e.Polyline([t],{weight:2,color:this.options.color,dashArray:[5,5],interactive:!1}),this._map.addLayer(this._directPath),this._trail.overlays.push(this._directPath))},_addMeasurePoint:function(t){this._measurePath?this._measurePath.addLatLng(t):(this.options.model==="area"?this._measurePath=new e.Polygon([t],{weight:2,color:this.options.color,fillColor:this.options.color,fillOpacity:.5,interactive:!1}):this._measurePath=new e.Polyline([t],{weight:2,color:this.options.color,interactive:!1}),this._map.addLayer(this._measurePath),this._trail.overlays.push(this._measurePath)),this._resetDirectPath(t)},_addMarker:function(t){var i=new e.CircleMarker(t,{color:this.options.color,opacity:1,weight:1,fillColor:"#FFFFFF",fill:!0,fillOpacity:1,radius:3,interactive:!1});this._map.addLayer(i),this._trail.overlays.push(i)},_addLable:function(t,i,a,s){var n=new e.MeasureLable({latlng:t,content:i,className:a});if(this._map.addLayer(n),this._trail.overlays.push(n),s){var o=n.enableClose();e.DomEvent.on(o,"click",this._clearOverlay,this)}},_clearOverlay:function(){var t=0,i=this._trail.overlays,a;for(a=i.length;t<a;t++)this._map.removeLayer(i[t])},toRadians:function(t){return t*(Math.PI/180)},square:function(t){return Math.pow(t,2)},_getDistanceString:function(t){return t<1e3?this._numberFormat(t,0)+" "+e.Measure.meter:this._numberFormat(t/1e3,2)+" "+e.Measure.kilometer},_getDistance:function(t,i){var a=6378137,s=this.toRadians(t.lat),n=this.toRadians(i.lat),o=n-s,r=this.toRadians(i.lng-t.lng),h=this.square(Math.sin(o/2))+Math.cos(s)*Math.cos(n)*this.square(Math.sin(r/2));return 2*a*Math.asin(Math.sqrt(h))},_getAreaString:function(t){var i=Math.round(this._getArea(t));return i<1e6?this._numberFormat(i,0)+" "+e.Measure.squareMeter:this._numberFormat(i/1e6,2)+" "+e.Measure.squareKilometers},_getArea:function(t){for(var i=6378137,a=0,s=t.length,n=t[s-1].lng,o=t[s-1].lat,r=0;r<s;r++){var h=t[r].lng,c=t[r].lat;a+=this.toRadians(h-n)*(2+Math.sin(this.toRadians(o))+Math.sin(this.toRadians(c))),n=h,o=c}return Math.abs(a*i*i/2)},_numberFormat:function(t,i=2){var a=",",s=t<0?"-":"",n=Math.abs(+t||0),o=parseInt(n.toFixed(i),10)+"",r=o.length>3?o.length%3:0;return[s,r?o.substr(0,r)+a:"",o.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+a),i?"."+Math.abs(n-o).toFixed(i).slice(2):""].join("")}}),e.measureAction=function(t,i){return new e.MeasureAction(t,i)}},window);const f={id:"leaf_map"},p={__name:"measureControl",setup(e){return _(()=>{var t=l.map("leaf_map",{crs:l.CRS.EPSG3857,center:[30.5217,114.3948],minZoom:1,maxZoom:18,zoom:18});l.tileLayer("http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=f6d75f77a5cb66b0fcfaec5cbe58a907",{noWrap:!0}).addTo(t),l.tileLayer("http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=f6d75f77a5cb66b0fcfaec5cbe58a907",{noWrap:!0}).addTo(t),l.Measure={linearMeasurement:"\u8DDD\u79BB\u6D4B\u91CF",areaMeasurement:"\u9762\u79EF\u6D4B\u91CF",start:"\u5F00\u59CB",meter:"\u7C73",kilometer:"\u516C\u91CC",squareMeter:"\u5E73\u65B9\u7C73",squareKilometers:"\u5E73\u65B9\u516C\u91CC"},l.control.measure({title:"\u6D4B\u91CF\u5DE5\u5177"}).addTo(t)}),(t,i)=>(d(),m("div",f))}};var b=u(p,[["__scopeId","data-v-61ec2ae2"]]);export{b as default};
