import{L as r}from"./leaflet-src.1665470366715.js";import{a as l}from"./index.1665470366715.js";import{a2 as h,l as d,a as c,o as f,aB as p,aC as m,b as g}from"./vue.1665470366715.js";L.interpolatePosition=function(t,i,a,e){var n=e/a;return n=n>0?n:0,n=n>1?1:n,L.latLng(t.lat+n*(i.lat-t.lat),t.lng+n*(i.lng-t.lng))};L.Marker.MovingMarker=L.Marker.extend({statics:{notStartedState:0,endedState:1,pausedState:2,runState:3},options:{autostart:!1,loop:!1},initialize:function(t,i,a){L.Marker.prototype.initialize.call(this,t[0],a),this._latlngs=t.map(function(e,n){return L.latLng(e)}),i instanceof Array?this._durations=i:this._durations=this._createDurations(this._latlngs,i),this._currentDuration=0,this._currentIndex=0,this._state=L.Marker.MovingMarker.notStartedState,this._startTime=0,this._startTimeStamp=0,this._pauseStartTime=0,this._animId=0,this._animRequested=!1,this._currentLine=[],this._stations={}},isRunning:function(){return this._state===L.Marker.MovingMarker.runState},isEnded:function(){return this._state===L.Marker.MovingMarker.endedState},isStarted:function(){return this._state!==L.Marker.MovingMarker.notStartedState},isPaused:function(){return this._state===L.Marker.MovingMarker.pausedState},start:function(){this.isRunning()||(this.isPaused()?this.resume():(this._loadLine(0),this._startAnimation(),this.fire("start")))},resume:function(){!this.isPaused()||(this._currentLine[0]=this.getLatLng(),this._currentDuration-=this._pauseStartTime-this._startTime,this._startAnimation())},pause:function(){!this.isRunning()||(this._pauseStartTime=Date.now(),this._state=L.Marker.MovingMarker.pausedState,this._stopAnimation(),this._updatePosition())},stop:function(t){this.isEnded()||(this._stopAnimation(),typeof t=="undefined"&&(t=0,this._updatePosition()),this._state=L.Marker.MovingMarker.endedState,this.fire("end",{elapsedTime:t}))},addLatLng:function(t,i){this._latlngs.push(L.latLng(t)),this._durations.push(i)},moveTo:function(t,i){this._stopAnimation(),this._latlngs=[this.getLatLng(),L.latLng(t)],this._durations=[i],this._state=L.Marker.MovingMarker.notStartedState,this.start(),this.options.loop=!1},addStation:function(t,i){t>this._latlngs.length-2||t<1||(this._stations[t]=i)},onAdd:function(t){if(L.Marker.prototype.onAdd.call(this,t),this.options.autostart&&!this.isStarted()){this.start();return}this.isRunning()&&this._resumeAnimation()},onRemove:function(t){L.Marker.prototype.onRemove.call(this,t),this._stopAnimation()},_createDurations:function(t,i){for(var a=t.length-1,e=[],n=0,o=0,s=0;s<a;s++)o=t[s+1].distanceTo(t[s]),e.push(o),n+=o;var _=i/n,u=[];for(s=0;s<e.length;s++)u.push(e[s]*_);return u},_startAnimation:function(){this._state=L.Marker.MovingMarker.runState,this._animId=L.Util.requestAnimFrame(function(t){this._startTime=Date.now(),this._startTimeStamp=t,this._animate(t)},this,!0),this._animRequested=!0},_resumeAnimation:function(){this._animRequested||(this._animRequested=!0,this._animId=L.Util.requestAnimFrame(function(t){this._animate(t)},this,!0))},_stopAnimation:function(){this._animRequested&&(L.Util.cancelAnimFrame(this._animId),this._animRequested=!1)},_updatePosition:function(){var t=Date.now()-this._startTime;this._animate(this._startTimeStamp+t,!0)},_loadLine:function(t){this._currentIndex=t,this._currentDuration=this._durations[t],this._currentLine=this._latlngs.slice(t,t+2)},_updateLine:function(t){var i=t-this._startTimeStamp;if(i<=this._currentDuration)return i;for(var a=this._currentIndex,e=this._currentDuration,n;i>e;){if(i-=e,n=this._stations[a+1],n!==void 0){if(i<n)return this.setLatLng(this._latlngs[a+1]),null;i-=n}if(a++,a>=this._latlngs.length-1)if(this.options.loop)a=0,this.fire("loop",{elapsedTime:i});else return this.setLatLng(this._latlngs[this._latlngs.length-1]),this.stop(i),null;e=this._durations[a]}return this._loadLine(a),this._startTimeStamp=t-i,this._startTime=Date.now()-i,i},_animate:function(t,i){this._animRequested=!1;var a=this._updateLine(t);if(!this.isEnded()){if(a!=null){var e=L.interpolatePosition(this._currentLine[0],this._currentLine[1],this._currentDuration,a);this.setLatLng(e)}i||(this._animId=L.Util.requestAnimFrame(this._animate,this,!1),this._animRequested=!0)}}});L.Marker.movingMarker=function(t,i,a){return new L.Marker.MovingMarker(t,i,a)};const v=t=>(p("data-v-2fc89844"),t=t(),m(),t),M=v(()=>g("div",{id:"leaf_map"},null,-1)),k=[M],S={__name:"featureMigrate",setup(t){let i=h({});return h([]),d(()=>{i=r.map("leaf_map").setView([30.5217,114.3948],18),r.tileLayer("http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=f6d75f77a5cb66b0fcfaec5cbe58a907",{noWrap:!0}).addTo(i),r.tileLayer("http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=f6d75f77a5cb66b0fcfaec5cbe58a907",{noWrap:!0}).addTo(i);var a=[[30.52247,114.39332],[30.5209,114.39332]];r.polyline(a).addTo(i);var e=r.Marker.movingMarker(a,[1e4]).addTo(i);e.once("click",function(){e.start(),e.closePopup(),e.unbindPopup(),e.on("click",function(){e.isRunning()?e.pause():e.start()}),setTimeout(function(){e.bindPopup("<b>Click me to pause !</b>").openPopup()},2e3)}),e.bindPopup("<b>Click me to start !</b>",{closeOnClick:!1}).openPopup()}),(a,e)=>(f(),c("div",null,k))}};var y=l(S,[["__scopeId","data-v-2fc89844"]]);export{y as default};
